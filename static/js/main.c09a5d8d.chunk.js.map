{"version":3,"sources":["../../src/contants.ts","../../src/theme.ts","../../src/util.tsx","../../src/shape/node.tsx","../../src/shape/ringEdge.tsx","../../src/shape/edge.tsx","../../src/shape/groupNode.tsx","../../src/index.tsx","App.tsx","Col.tsx","index.tsx"],"names":["isGroup","Symbol","_theme","nodeWidth","nodeHeight","halfNodeWidth","halfNodeHeight","nodeBorderRadio","primaryColor","primaryColumnColor","primaryBorder","primaryBg","primaryBorderRadio","secondaryColor","secondaryColumnColor","secondaryBg","secondaryBorder","secondaryBorderRadio","disableColor","disableColumnColor","disableBg","disableBorder","disableBorderRadio","activeColor","activeColumnColor","activeBg","activeBorder","activeBorderRadio","searchBg","searchColor","groupBorder","groupBg","groupColor","edgeColor","edgeWidth","disableedgeColor","activeNodeColor","fontFamily","hoverBg","nodeDot","hive","clickhouse","mysql","kafka","hdfs","druid","abase","tableau","abtest","redis","undefined","getTheme","key","canvas","document","createElement","width","height","style","display","body","appendChild","ctx","getContext","font","measureText","text","formatText","label","color","searchKey","labels","x","split","forEach","item","index","push","listening","fontSize","fill","slice","length","fittingString","str","maxWidth","fontWidth","len","textWidths","i","charCodeAt","calcStrLen","splitLength","Math","floor","substring","lineGenerator","line","d","y","getPathData","points","curve","curveBasis","map","DagNode","type","node","onContextMenu","onClick","onHover","onOutHover","stage","nodeOnHover","useRef","onMouseEnter","useCallback","e","console","log","current","onMouseLeave","cornerRadius","stroke","$state$","strokeWidth","columns","col","$columnMap$","id","opacity","cancelBubble","target","setAttr","getStage","batchDraw","dbType","RingEdge","startPoint","endPoint","direction","ctp1","ctp2","data","offsetY","offsetX","rotation","DagEdge","startNode","endNode","edge","useMemo","startCol","endCol","getPoints","JSON","stringify","pts","angle","atan2","PI","pointerWidth","pointerLength","bezier","DagGroupNode","groupBy","dash","Dag","props","state","dimensions","graph","React","layer","fitView","getClientRect","skipTransform","stageWidth","stageHeight","radio","min","scale","mousePointTo","position","onWheel","evt","preventDefault","oldScale","scaleX","getPointerPosition","newScale","deltaY","newPos","setGraph","nodes","edges","activeNode","primaryNode","this","graphlib","Graph","directed","multigraph","compound","rankdir","edgesep","setDefaultEdgeLabel","l","setNode","start","end","columnId","setEdge","res","_","Object","keys","groupId","setParent","layout","selectColId","nextProps","nextState","prevProps","prevState","bounds","onResize","contentRect","setState","measureRef","ref","className","dragBoundFunc","pos","draggable","v","onNodeContextMenu","onNodeClick","w","name","defaultProps","App","useState","setActiveNode","column","ReactDOM","render","window","location","pathname","includes","Col","getElementById"],"mappings":"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","file":"static/js/main.c09a5d8d.chunk.js","sourcesContent":["export const isGroup: unique symbol = Symbol('isGroup');\n","let _theme = {\n  nodeWidth: 158,\n  nodeHeight: 28,\n  halfNodeWidth: 79,\n  halfNodeHeight: 14,\n  nodeBorderRadio: [2, 2, 2, 2],\n  primaryColor: '#ffffff',\n  primaryColumnColor: '#606a78',\n  primaryBorder: '#4660ef',\n  primaryBg: '#4660ef',\n  primaryBorderRadio: [2, 2, 2, 2],\n  secondaryColor: '#282f38',\n  secondaryColumnColor: '#606a78',\n  secondaryBg: '#ffffff',\n  secondaryBorder: '#8b9dff',\n  secondaryBorderRadio: [2, 2, 2, 2],\n  disableColor: '#ffffff',\n  disableColumnColor: '#939aa3',\n  disableBg: '#c3c8cd',\n  disableBorder: '#f5f6fa',\n  disableBorderRadio: [2, 2, 2, 2],\n  activeColor: '#416eff',\n  activeColumnColor: '#416eff',\n  activeBg: '#ffffff',\n  activeBorder: '#8b9dff',\n  activeBorderRadio: [2, 2, 2, 2],\n  searchBg: '#ffe95b',\n  searchColor: '#282f38',\n  groupBorder: '#4660ef',\n  groupBg: '#4660ef',\n  groupColor: '#ffffff',\n  edgeColor: '#a8b6c7',\n  edgeWidth: 1.5,\n  disableedgeColor: '#d5dadf',\n  activeNodeColor: '#416eff',\n  fontFamily: 'Ubuntu Mono, Tahoma',\n  hoverBg: '#f5f6fa',\n  nodeDot: {\n    hive: '#33d6cc',\n    clickhouse: '#f5f6fa',\n    mysql: '#8a77ed',\n    kafka: '#34adf0',\n    hdfs: '#5dcd81',\n    druid: '#ed55b0',\n    abase: '#33d6cc',\n    tableau: '#ffbc0a',\n    abtest: '#8a77ed',\n    redis: '#34adf0',\n    undefined: '#f25c61',\n  },\n};\n\nexport type themeType<T> = {\n  [key in keyof T]?: T[key];\n};\n\nexport const mergeTheme = (theme: themeType<typeof _theme>) => {\n  _theme = Object.assign(_theme, theme);\n};\n\nexport const getTheme = (key?: string) => {\n  if (key) {\n    return _theme[key];\n  }\n  return _theme;\n};\n","import React from 'react';\nimport { Label, Tag, Text } from 'react-konva';\nimport { curveBasis, line } from 'd3-shape';\nimport { getTheme } from './theme';\n\nconst canvas = document.createElement('canvas');\ncanvas.width = 300;\ncanvas.height = 300;\ncanvas.style.display = 'none';\ndocument.body.appendChild(canvas);\nconst ctx = canvas.getContext('2d');\nctx!.font = '12px Arial';\n\nexport const measureText = function (text: string) {\n  return ctx!.measureText(text).width;\n};\n\nexport const formatText = function (label: any, color: string, searchKey?: string) {\n  const { searchBg, searchColor, fontFamily } = getTheme();\n  if (!searchKey) {\n    return (\n      <Text\n        listening={false}\n        text={`${label}`}\n        fontSize={12}\n        fill={color}\n        fontFamily={fontFamily}\n      />\n    );\n  } else {\n    const labels: any[] = [];\n    let x = 0;\n    label.split(searchKey).forEach((item: string, index: number) => {\n      labels.push(\n        <Text\n          listening={false}\n          x={x}\n          key={`${index}-1`}\n          text={item}\n          fontSize={12}\n          fill={color}\n          fontFamily={fontFamily}\n        />\n      );\n      x += measureText(item);\n      labels.push(\n        <Label listening={false} x={x} key={`${index}-2`}>\n          <Tag fill={searchBg} />\n          <Text fontSize={12} fill={searchColor} text={searchKey} fontFamily={fontFamily} />\n        </Label>\n      );\n      x += measureText(searchKey);\n    });\n    return labels.slice(0, labels.length - 1);\n  }\n};\n\n/**\n * 计算字符串的长度\n * @param {string} str 指定的字符串\n */\nexport const calcStrLen = function calcStrLen(str: string) {\n  let len = 0,\n    textWidths = [];\n  for (let i = 0; i < str.length; i++) {\n    if (str.charCodeAt(i) > 0 && str.charCodeAt(i) < 128) {\n      len++;\n      textWidths.push(1);\n    } else {\n      textWidths.push(2);\n      len += 2;\n    }\n  }\n  return { len, textWidths };\n};\n\n/**\n * 计算显示的字符串\n * @param {string} str 要裁剪的字符串\n * @param {number} maxWidth 最大宽度\n * @param {number} fontSize 字体大小\n */\nexport const fittingString = function fittingString(\n  str: string,\n  maxWidth: number,\n  fontSize: number\n) {\n  const fontWidth = fontSize * 1.3; //字号+边距\n  maxWidth = maxWidth * 2; // 需要根据自己项目调整\n  const { len, textWidths } = calcStrLen(str);\n  const width = len * fontWidth;\n  const ellipsis = '…';\n  if (width > maxWidth) {\n    let splitLength = Math.floor((width - maxWidth) / fontWidth),\n      i = textWidths.length - 1;\n    for (; i >= 0; i--) {\n      const item = textWidths[i];\n      splitLength -= item;\n      if (splitLength < 0) {\n        break;\n      }\n    }\n    // var actualLen = Math.floor((maxWidth - 20) / fontWidth)\n    var result = str.substring(0, i) + ellipsis;\n    return result;\n  }\n  return str;\n};\n\nexport const lineGenerator = line()\n  .x(function (d) {\n    return d[0];\n  })\n  .y(function (d) {\n    return d[1];\n  });\n\nexport function getPathData(points: { x: number; y: number }[]): string {\n  // TODO 加缓存？\n  const data = lineGenerator.curve(curveBasis)(points.map((item) => [item.x, item.y]));\n  // console.log(data)\n  return data!;\n}\n\nexport function pathDataToPoints(data: string) {\n  return data\n    .split(/(?=[LMC])/)\n    .map((item) => item.slice(1).split(',').map(Number))\n    .flat();\n}\n","import React, { useCallback, useRef } from 'react';\nimport { Group, Rect } from 'react-konva';\nimport { Node as DNode } from 'dagre';\nimport { getTheme } from '../theme';\nimport { Node, onNodeHover, onNodeClick, onNodeContextMenu, onNodeOutHover } from '../types';\nimport { fittingString, formatText } from '../util';\nimport { Stage } from 'react-konva';\n\nexport const DagNode: React.FC<{\n  node: DNode<Node>;\n  onClick?: onNodeClick;\n  onContextMenu?: onNodeContextMenu;\n  onHover?: onNodeHover;\n  onOutHover?: onNodeOutHover;\n  activeNode?: Node;\n  searchKey?: string;\n  stage?: Stage;\n  type: string;\n}> = ({ type, node, onContextMenu, onClick, onHover, onOutHover, searchKey, stage }) => {\n  const nodeOnHover = useRef(false);\n  const onMouseEnter = onHover\n    ? useCallback((e) => {\n        console.log(e);\n        if (!nodeOnHover.current) {\n          onHover && onHover(node);\n        }\n        nodeOnHover.current = true;\n      }, [])\n    : undefined;\n  const onMouseLeave = onOutHover\n    ? useCallback(() => {\n        if (nodeOnHover.current) {\n          onOutHover && onOutHover(node);\n        }\n        nodeOnHover.current = false;\n      }, [])\n    : undefined;\n  const { nodeWidth } = getTheme();\n  return (\n    <Group\n      x={node.x - node.width / 2}\n      y={node.y - node.height / 2}\n      onClick={(e) => {\n        onClick && onClick(e, node);\n      }}\n      onContextMenu={(e) => {\n        onContextMenu && onContextMenu(e, node);\n      }}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n    >\n      {type === 'column' && (\n        <>\n          <Rect\n            listening={false}\n            cornerRadius={getTheme().nodeBorderRadio}\n            fill={'#FFFFFF'}\n            stroke={getTheme(`${node.$state$}Border`)}\n            strokeWidth={1.5}\n            width={node.width}\n            height={getTheme().nodeHeight * ((node.columns?.length || 0) + 1)}\n          />\n          {node.columns?.map((col, index) => {\n            if (!node.$columnMap$) {\n              node.$columnMap$ = {};\n            }\n            node.$columnMap$[col.id] = { ...col, index: index + 1 };\n            return (\n              <Group key={col.id}>\n                <Group\n                  x={18}\n                  y={getTheme().nodeHeight * (index + 1) + getTheme().halfNodeHeight - 6}\n                  height={getTheme().nodeHeight}\n                >\n                  <Rect\n                    cornerRadius={getTheme().nodeBorderRadio}\n                    fill={getTheme().hoverBg}\n                    opacity={0}\n                    strokeWidth={0}\n                    x={-17}\n                    y={6 - getTheme().halfNodeHeight}\n                    width={node.width - 2}\n                    height={getTheme().nodeHeight}\n                    onClick={(e) => {\n                      e.cancelBubble = true;\n                      onClick && onClick(e, node, col);\n                    }}\n                    onMouseEnter={(e) => {\n                      e.target.setAttr('opacity', 1);\n                      stage!.getStage().batchDraw();\n                    }}\n                    onMouseLeave={(e) => {\n                      e.target.setAttr('opacity', 0);\n                      stage!.getStage().batchDraw();\n                    }}\n                  />\n                  {formatText(\n                    fittingString(col.label, nodeWidth - 20, 12),\n                    getTheme(`${col.$state$ || node.$state$}ColumnColor`),\n                    searchKey\n                  )}\n                </Group>\n              </Group>\n            );\n          })}\n        </>\n      )}\n      <Rect\n        cornerRadius={getTheme().nodeBorderRadio}\n        fill={getTheme(`${node.$state$}Bg`)}\n        stroke={getTheme(`${node.$state$}Border`)}\n        strokeWidth={1.5}\n        width={node.width}\n        height={getTheme().nodeHeight}\n      />\n      <Rect\n        fill={getTheme().nodeDot[node.dbType]}\n        cornerRadius={[1, 1, 1, 1]}\n        width={6}\n        height={6}\n        x={8}\n        y={getTheme().halfNodeHeight - 3}\n      />\n      <Group x={18} y={getTheme().halfNodeHeight - 6}>\n        {formatText(\n          fittingString(node.label, nodeWidth - 20, 12),\n          getTheme(`${node.$state$}Color`),\n          searchKey\n        )}\n      </Group>\n    </Group>\n  );\n};\n","import { Group, Path } from 'react-konva';\nimport React from 'react';\nimport { Point } from '../types';\nimport { getTheme } from '../theme';\n\nexport const RingEdge: React.FC<{\n  startPoint: Point;\n  endPoint: Point;\n  direction: string;\n  edgeColor?: string;\n}> = function ({ startPoint, endPoint, direction, edgeColor }) {\n  // 控制点\n  let ctp1 = '',\n    ctp2 = '';\n  if (direction === 'top') {\n    ctp1 = `${startPoint.x - 80} ${startPoint.y - 40}`;\n    ctp2 = `${startPoint.x + 80} ${startPoint.y - 40}`;\n  } else if (direction === 'bottom') {\n    ctp1 = `${startPoint.x - 80} ${startPoint.y + 40}`;\n    ctp2 = `${startPoint.x + 80} ${startPoint.y + 40}`;\n  } else if (direction === 'right') {\n    ctp1 = `${startPoint.x + 40} ${startPoint.y + 80}`;\n    ctp2 = `${endPoint.x + 40} ${endPoint.y - 80}`;\n  } else {\n    ctp1 = `${startPoint.x - 40} ${startPoint.y + 80}`;\n    ctp2 = `${endPoint.x + 40} ${endPoint.y - 80}`;\n  }\n  const { edgeWidth } = getTheme();\n  return (\n    <Group listening={false}>\n      <Path\n        data={`M${startPoint.x} ${startPoint.y} C${ctp1} ${ctp2} ${endPoint.x} ${endPoint.y}`}\n        stroke={edgeColor}\n        strokeWidth={edgeWidth}\n      />\n      <Group x={startPoint.x} y={startPoint.y}>\n        <Path\n          offsetY={0}\n          offsetX={0}\n          rotation={-30}\n          fill={edgeColor}\n          data={`M 0 0 L -5 -2.5 L -5 2.5 Z`}\n        />\n      </Group>\n    </Group>\n  );\n};\n","import React, { useMemo } from 'react';\nimport { Group, Path, Arrow } from 'react-konva';\nimport { GraphEdge, Node as DNode } from 'dagre';\nimport { getTheme } from '../theme';\nimport { Node } from '../types';\nimport { getPathData } from '../util';\nimport { RingEdge } from './ringEdge';\n\nfunction getPoints(startNode: DNode<Node>, endNode: DNode<Node>, edge: GraphEdge, type: string) {\n  if (type === 'column') {\n    // 先遍历的边，所有边上都会新增一个 $columnMap$ 属性做col的 map\n    //   start: '1',\n    //   end: '5',\n    //   startCol: '2',\n    //   endCol: '1',\n    const startCol = startNode.$columnMap$[edge.startCol],\n      endCol = endNode.$columnMap$[edge.endCol];\n    const { nodeHeight } = getTheme();\n    return [\n      {\n        x: startNode.x + startNode.width / 2,\n        y: startNode.y - startNode.height / 2 + nodeHeight * (startCol.index + 0.5),\n      },\n      ...edge.points.slice(1, -1),\n      {\n        x: endNode.x - endNode.width / 2,\n        y: endNode.y - endNode.height / 2 + nodeHeight * (endCol.index + 0.5),\n      },\n    ];\n  }\n  return [\n    { x: startNode.x + startNode.width / 2, y: startNode.y },\n    ...edge.points.slice(1, -1),\n    { x: endNode.x - endNode.width / 2, y: endNode.y },\n  ];\n}\n\nexport const DagEdge: React.FC<{\n  startNode: DNode<Node>;\n  endNode: DNode<Node>;\n  edge: GraphEdge;\n  type: string;\n  activeNode?: Node;\n}> = ({ startNode, endNode, edge, type }) => {\n  const edgeColor = getTheme(`${edge.$state$}edgeColor`);\n  // console.log('edge xxx', startNode, endNode, edge);\n  // 自包含环形边\n  if (startNode.id === endNode.id) {\n    const startPoint = {\n      x: startNode.x,\n      y: startNode.y + startNode.height / 2,\n    };\n    return (\n      <RingEdge\n        edgeColor={edgeColor}\n        direction={'bottom'}\n        startPoint={startPoint}\n        endPoint={startPoint}\n      />\n    );\n  }\n  const points = useMemo(() => getPoints(startNode, endNode, edge, type), [\n    startNode.y,\n    startNode.x,\n    endNode.x,\n    endNode.y,\n    JSON.stringify(edge.points),\n    type,\n  ]);\n  const startPoint = points[0],\n    endPoint = points[edge.points.length - 1],\n    pts =\n      points.length <= 4\n        ? { x: (startPoint.x + endPoint.x) / 2, y: endPoint.y }\n        : points[edge.points.length - 2];\n  const { edgeWidth } = getTheme();\n  // const pathData =\n  //   points.length <= 4\n  //     ? `M ${startPoint.x} ${startPoint.y}\n  // C ${(startPoint.x + endPoint.x) / 2} ${startPoint.y},\n  //   ${pts.x} ${pts.y},\n  //   ${endPoint.x} ${endPoint.y}`\n  //     : getPathData(points);\n  const angle = useMemo(() => {\n    const radina = Math.atan2(endPoint.y - pts.y, endPoint.x - pts.x);\n    const angle = (radina * 180) / Math.PI;\n    return angle;\n  }, [endPoint.x, endPoint.y, pts.y, pts.x]);\n  // console.log('angle', angle, startNode, endNode, pts, endPoint);\n  return (\n    <Group listening={false}>\n      {points.length <= 4 ? (\n        <Arrow\n          listening={false}\n          points={[\n            startPoint.x,\n            startPoint.y,\n            (startPoint.x + endPoint.x) / 2,\n            startPoint.y,\n            pts.x,\n            pts.y,\n            endPoint.x,\n            endPoint.y,\n          ]}\n          pointerWidth={3}\n          pointerLength={3}\n          bezier={true}\n          stroke={edgeColor}\n          strokeWidth={1.5}\n        />\n      ) : (\n        <>\n          <Path data={getPathData(points)} stroke={edgeColor} strokeWidth={edgeWidth} />\n          <Group x={endPoint.x} y={endPoint.y}>\n            <Path\n              rotation={angle}\n              data={'M 0 0 L -5 -2.5 L -5 2.5 z'}\n              fill={edgeColor}\n              strokeWidth={edgeWidth}\n            />\n          </Group>\n        </>\n      )}\n      {/*<Line points={points.map((item) => [item.x, item.y]).flat()} stroke={'red'} strokeWidth={2} />*/}\n      {/*<Path data={pathData} stroke={edgeColor} strokeWidth={edgeWidth} />*/}\n      {/*<Group x={endPoint.x} y={endPoint.y}>*/}\n      {/*  <Path*/}\n      {/*    rotation={-angle}*/}\n      {/*    data={'M 0 0 L -5 -2.5 L -5 2.5 z'}*/}\n      {/*    fill={edgeColor}*/}\n      {/*    strokeWidth={edgeWidth}*/}\n      {/*  />*/}\n      {/*</Group>*/}\n    </Group>\n  );\n};\n","import React from 'react';\nimport { Group, Rect, Text } from 'react-konva';\nimport { Node as DNode } from 'dagre';\nimport { getTheme } from '../theme';\nimport { GroupBy, Node } from '../types';\nimport { measureText } from '../util';\n\nexport const DagGroupNode: React.FC<{ node: DNode<Node>; groupBy: GroupBy }> = ({\n  node,\n  groupBy,\n}) => {\n  // console.log('node',node)\n  const text = `${groupBy.label}: ${node[groupBy.key]}`;\n  return (\n    <Group listening={false} x={node.x - node.width / 2} y={node.y - node.height / 2}>\n      <Group x={0} y={-27}>\n        <Rect\n          cornerRadius={[2, 2, 2, 2]}\n          height={28}\n          width={measureText(text) + 8}\n          fill={getTheme().groupBg}\n        />\n        <Text text={text} fill={getTheme().groupColor} y={8} x={4} />\n      </Group>\n      <Rect\n        listening={false}\n        dash={[4, 4]}\n        stroke={getTheme().groupBorder}\n        strokeWidth={1.5}\n        width={node.width}\n        height={node.height}\n      />\n    </Group>\n  );\n};\n","import './styles.css';\nimport Measure from 'react-measure';\nimport * as React from 'react';\nimport { Stage, Layer } from 'react-konva';\nimport { graphlib, layout } from 'dagre';\nimport Konva from 'konva';\nimport _ from 'lodash';\nimport { isGroup } from './contants';\nimport {\n  Edge,\n  GroupBy,\n  Node,\n  onNodeClick,\n  onNodeContextMenu,\n  onNodeHover,\n  onNodeOutHover,\n} from './types';\nimport { DagNode } from './shape/node';\nimport { DagEdge } from './shape/edge';\nimport { DagGroupNode } from './shape/groupNode';\nimport { getTheme } from './theme';\n\ntype Props = {\n  edges: Edge[];\n  nodes: Node[];\n  type?: 'column' | 'default';\n  activeNode?: { id: string; columnId?: string };\n  primaryNode?: { id: string };\n  groupBy?: GroupBy;\n  onNodeClick?: onNodeClick;\n  onNodeContextMenu?: onNodeContextMenu;\n  onNodeHover?: onNodeHover;\n  onNodeOutHover?: onNodeOutHover;\n  searchKey?: string;\n};\n\ntype State = {\n  dimensions: {\n    width: number;\n    height: number;\n  };\n};\n\nexport default class Dag extends React.Component<Props, State> {\n  state = {\n    dimensions: {\n      width: 0,\n      height: 0,\n    },\n  };\n\n  static defaultProps = {\n    type: 'default',\n  };\n\n  graph: graphlib.Graph<Node>;\n\n  stage = React.createRef<Stage>();\n  layer = React.createRef<Konva.Layer>();\n\n  constructor(props: Props) {\n    super(props);\n    this.setGraph(props);\n  }\n\n  setGraph({ nodes, edges, type, groupBy, activeNode, primaryNode }: Props) {\n    this.graph = new graphlib.Graph<Node>({\n      directed: true,\n      multigraph: true,\n      compound: !!groupBy,\n    });\n    this.graph\n      .setGraph({\n        rankdir: 'LR',\n        edgesep: 40,\n      })\n      .setDefaultEdgeLabel(function () {\n        return {};\n      });\n    let $state$ = activeNode ? 'disable' : 'secondary';\n    const { nodeHeight, nodeWidth } = getTheme();\n    nodes.forEach((node) => {\n      const l = type === 'column' && node.columns?.length ? node.columns?.length + 1 : 1;\n      this.setNode(\n        {\n          label: node.id,\n          width: nodeWidth,\n          height: nodeHeight * l,\n          $state$,\n          ...node,\n        },\n        $state$,\n        type,\n        primaryNode\n      );\n    });\n    edges.forEach((edge: Edge, index) => {\n      if (activeNode) {\n        if (edge.start === activeNode.id || edge.end === activeNode.id) {\n          if (\n            (type === 'column' &&\n              ((edge.start === activeNode.id && edge.startCol === activeNode.columnId) ||\n                (edge.end === activeNode.id && edge.endCol === activeNode.columnId))) ||\n            type !== 'column'\n          ) {\n            $state$ = 'active';\n            const startNode = this.graph.node(edge.start);\n            const endNode = this.graph.node(edge.end);\n            this.setNode(startNode, $state$, type, primaryNode, edge.start);\n            this.setNode(endNode, $state$, type, primaryNode, edge.end);\n            this.graph.setEdge(edge.start, edge.end, { ...edge, $state$: '' }, `${index}`);\n            return;\n          }\n        }\n        this.graph.setEdge(edge.start, edge.end, { ...edge, $state$: 'disable' }, `${index}`);\n      } else {\n        this.graph.setEdge(edge.start, edge.end, { ...edge, $state$: '' }, `${index}`);\n      }\n    });\n    if (groupBy) {\n      const res = _.groupBy(nodes, groupBy.key);\n      Object.keys(res).forEach((key) => {\n        const groupId = `$group_${key}$`;\n        this.graph.setNode(groupId, {\n          label: key,\n          [groupBy.key]: key,\n          [isGroup]: true,\n        });\n        res[key].forEach((node) => {\n          this.graph.setParent(node.id, groupId);\n        });\n      });\n    }\n    layout(this.graph);\n  }\n\n  setNode(\n    node: Node,\n    $state$: string,\n    type?: string,\n    primaryNode?: { id: string },\n    selectColId?: string\n  ) {\n    type === 'column' &&\n      node.columns?.forEach((col) => {\n        if (col.id == selectColId) {\n          col.$state$ = $state$;\n        }\n      });\n    if (primaryNode?.id && primaryNode?.id == node.id) {\n      this.graph.setNode(node.id, { ...node, $state$: 'primary' });\n    } else {\n      this.graph.setNode(node.id, {\n        ...node,\n        $state$: type === 'column' && $state$ === 'active' ? 'secondary' : $state$,\n      });\n    }\n  }\n\n  shouldComponentUpdate(nextProps: Readonly<Props>, nextState: Readonly<State>) {\n    if (this.props === nextProps && this.state === nextState) {\n      return false;\n    }\n    if (this.props.nodes !== nextProps.nodes || this.props.edges !== nextProps.edges) {\n      this.setGraph(nextProps);\n    }\n    return true;\n  }\n\n  componentDidUpdate(prevProps: Readonly<Props>, prevState: Readonly<State>) {\n    if (\n      prevState.dimensions !== this.state.dimensions ||\n      this.props.nodes !== prevProps.nodes ||\n      this.props.edges !== prevProps.edges\n    ) {\n      this.fitView();\n    }\n  }\n\n  getStage = () => {\n    return this.stage.current!.getStage();\n  };\n\n  fitView = () => {\n    const stage = this.getStage();\n    const { width, height } = this.state.dimensions;\n    const { width: stageWidth, height: stageHeight } = stage.getClientRect({\n      skipTransform: true,\n    });\n    const radio = Math.min(width / stageWidth, height / stageHeight) - 0.15;\n    if (radio < 1) {\n      stage.getStage().scale({ x: radio, y: radio });\n      const mousePointTo = {\n        x: width / 2 - (stageWidth * radio) / 2,\n        y: height / 2 - (stageHeight * radio) / 2,\n      };\n      stage.position(mousePointTo);\n    } else {\n      const mousePointTo = {\n        x: width / 2 - stageWidth / 2,\n        y: height / 2 - stageHeight / 2,\n      };\n      stage.position(mousePointTo);\n    }\n    stage.batchDraw();\n  };\n\n  onWheel = (e: Konva.KonvaEventObject<WheelEvent>) => {\n    e.evt.preventDefault();\n    const scaleBy = 0.96;\n    const stage = this.stage.current!.getStage();\n    const oldScale = stage.scaleX();\n    const mousePointTo = {\n      x: stage.getPointerPosition()!.x / oldScale - stage.x() / oldScale,\n      y: stage.getPointerPosition()!.y / oldScale - stage.y() / oldScale,\n    };\n    const newScale = e.evt.deltaY > 0 ? oldScale * scaleBy : oldScale / scaleBy;\n    if (e.evt.deltaY > 0 && newScale < 0.1) {\n      return;\n    }\n    stage.scale({ x: newScale, y: newScale });\n\n    const newPos = {\n      x: -(mousePointTo.x - stage.getPointerPosition()!.x / newScale) * newScale,\n      y: -(mousePointTo.y - stage.getPointerPosition()!.y / newScale) * newScale,\n    };\n    stage.position(newPos);\n    stage.batchDraw();\n  };\n\n  scale = (scale: number) => {\n    const stage = this.getStage();\n    if (scale < 0.1) {\n      return;\n    }\n    stage.getStage().scale({ x: scale, y: scale });\n    stage.batchDraw();\n  };\n\n  render() {\n    const { dimensions } = this.state;\n    return (\n      <Measure\n        bounds\n        onResize={(contentRect) => {\n          this.setState({\n            dimensions: contentRect.bounds || { width: 0, height: 0 },\n          });\n        }}\n      >\n        {({ measureRef }) => (\n          <div ref={measureRef} className=\"dag-container\">\n            <Stage\n              ref={this.stage}\n              onWheel={this.onWheel}\n              width={dimensions.width}\n              height={dimensions.height}\n              dragBoundFunc={function (pos) {\n                return {\n                  x: pos.x,\n                  y: pos.y,\n                };\n              }}\n              draggable\n            >\n              <Layer ref={this.layer}>\n                {/*先遍历node，这样才能提前索引 column*/}\n                {this.graph.nodes().map((v) => {\n                  const node = this.graph.node(v);\n                  // @ts-ignore\n                  if (node[isGroup]) {\n                    return <DagGroupNode key={v} node={node} groupBy={this.props.groupBy!} />;\n                  }\n                  return (\n                    <DagNode\n                      key={v}\n                      type={this.props.type!}\n                      node={node}\n                      onContextMenu={this.props.onNodeContextMenu}\n                      onClick={this.props.onNodeClick}\n                      activeNode={this.props.activeNode}\n                      searchKey={this.props.searchKey}\n                      stage={this.stage.current!}\n                    />\n                  );\n                })}\n                {this.graph.edges().map((e) => {\n                  const edge = this.graph.edge(e);\n                  const startNode = this.graph.node(e.v);\n                  const endNode = this.graph.node(e.w);\n                  return (\n                    <DagEdge\n                      key={e.v + e.w + e.name}\n                      type={this.props.type!}\n                      startNode={startNode}\n                      endNode={endNode}\n                      edge={edge}\n                      activeNode={this.props.activeNode}\n                    />\n                  );\n                })}\n              </Layer>\n            </Stage>\n          </div>\n        )}\n      </Measure>\n    );\n  }\n}\n","import React from 'react';\nimport Dag from '@library';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Dag\n        edges={[\n          {\n            start: '1',\n            end: '2',\n          },\n          {\n            start: '2',\n            end: '3',\n          },\n          {\n            start: '3',\n            end: '3',\n          },\n          {\n            start: '1',\n            end: '5',\n          },\n          {\n            start: '1',\n            end: '5',\n          },\n          {\n            start: '3',\n            end: '5',\n          },\n          {\n            start: '3',\n            end: '4',\n          },\n        ]}\n        nodes={[\n          {\n            id: '1',\n            name: '1',\n            label: '1',\n          },\n          { id: '2', name: '1', label: '2' },\n          { id: '3', name: '2', label: '3' },\n          { id: '4', name: '2', label: '4' },\n          { id: '5', name: '1', label: '5' },\n        ]}\n        groupBy={{\n          key: 'name',\n          label: '负责人',\n        }}\n        activeNode={{ id: '2' }}\n      />\n    </div>\n  );\n}\n\nexport default App;\n","import React, { useState } from 'react';\nimport Dag from '@library';\n\nfunction App() {\n  const [activeNode, setActiveNode] = useState<{ id: string; columnId?: string } | undefined>(\n    undefined\n  );\n  console.log('activeNode', activeNode);\n\n  return (\n    <div className=\"App\">\n      <Dag\n        edges={[\n          {\n            start: '1',\n            end: '2',\n            startCol: '1',\n            endCol: '2',\n          },\n          {\n            start: '2',\n            end: '3',\n            startCol: '1',\n            endCol: '2',\n          },\n          {\n            start: '3',\n            end: '3',\n            startCol: '1',\n            endCol: '2',\n          },\n          {\n            start: '1',\n            end: '5',\n            startCol: '1',\n            endCol: '2',\n          },\n          {\n            start: '1',\n            end: '5',\n            startCol: '2',\n            endCol: '1',\n          },\n          {\n            start: '3',\n            end: '5',\n            startCol: '1',\n            endCol: '2',\n          },\n          {\n            start: '3',\n            end: '4',\n            startCol: '1',\n            endCol: '2',\n          },\n        ]}\n        nodes={[\n          {\n            id: '1',\n            name: '1',\n            label: 'moring',\n            columns: [\n              { id: '1', label: 'nihao' },\n              { id: '2', label: 'moring' },\n            ],\n          },\n          {\n            id: '2',\n            name: '1',\n            label: 'nihao',\n            columns: [\n              { id: '1', label: 'nihao' },\n              { id: '2', label: 'moring' },\n              { id: '3', label: 'hello' },\n            ],\n          },\n          {\n            id: '3',\n            name: '2',\n            label: 'hello',\n            columns: [\n              { id: '1', label: 'hello' },\n              { id: '2', label: '2' },\n            ],\n          },\n          {\n            id: '4',\n            name: '2',\n            label: '42345678909876543245678987654324567890987654345678987654345t6y78',\n            columns: [\n              { id: '1', label: '1' },\n              { id: '2', label: '2' },\n              { id: '3', label: '3' },\n            ],\n          },\n          {\n            id: '5',\n            name: '1',\n            label: '5',\n            columns: [\n              { id: '1', label: '1' },\n              { id: '2', label: '2' },\n              { id: '3', label: '3' },\n            ],\n          },\n        ]}\n        groupBy={{\n          key: 'name',\n          label: '负责人',\n        }}\n        type={'column'}\n        primaryNode={{ id: '2' }}\n        activeNode={activeNode}\n        searchKey={'hello'}\n        onNodeClick={(e, node, column) => {\n          console.log(e, node, column);\n          if (node.id === activeNode?.id) {\n            if (activeNode.columnId === column?.id) {\n              setActiveNode(undefined);\n              return;\n            }\n          }\n          setActiveNode({\n            id: node.id,\n            columnId: column?.id,\n          });\n        }}\n      />\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport Col from './Col';\n\nReactDOM.render(\n  <>{window.location.pathname.includes('col') ? <Col /> : <App />}</>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}