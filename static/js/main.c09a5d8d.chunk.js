(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[0],{158:function(e,t,n){e.exports=n(391)},163:function(e,t,n){},164:function(e,t,n){},391:function(e,t,n){"use strict";n.r(t);var a=n(11),o=n.n(a),r=n(149),i=n.n(r),d=(n(163),n(38)),c=n(20),l=n(150),s=n(151),u=n(154),h=n(157),f=(n(164),n(156)),g=n(0),p=n.n(g),m=n(5),y=n(82),v=n(153),b=n.n(v),x=Symbol("isGroup"),C={nodeWidth:158,nodeHeight:28,halfNodeWidth:79,halfNodeHeight:14,nodeBorderRadio:[2,2,2,2],primaryColor:"#ffffff",primaryColumnColor:"#606a78",primaryBorder:"#4660ef",primaryBg:"#4660ef",primaryBorderRadio:[2,2,2,2],secondaryColor:"#282f38",secondaryColumnColor:"#606a78",secondaryBg:"#ffffff",secondaryBorder:"#8b9dff",secondaryBorderRadio:[2,2,2,2],disableColor:"#ffffff",disableColumnColor:"#939aa3",disableBg:"#c3c8cd",disableBorder:"#f5f6fa",disableBorderRadio:[2,2,2,2],activeColor:"#416eff",activeColumnColor:"#416eff",activeBg:"#ffffff",activeBorder:"#8b9dff",activeBorderRadio:[2,2,2,2],searchBg:"#ffe95b",searchColor:"#282f38",groupBorder:"#4660ef",groupBg:"#4660ef",groupColor:"#ffffff",edgeColor:"#a8b6c7",edgeWidth:1.5,disableedgeColor:"#d5dadf",activeNodeColor:"#416eff",fontFamily:"Ubuntu Mono, Tahoma",hoverBg:"#f5f6fa",nodeDot:{hive:"#33d6cc",clickhouse:"#f5f6fa",mysql:"#8a77ed",kafka:"#34adf0",hdfs:"#5dcd81",druid:"#ed55b0",abase:"#33d6cc",tableau:"#ffbc0a",abtest:"#8a77ed",redis:"#34adf0",undefined:"#f25c61"}},E=function(e){return e?C[e]:C},k=n(395),w=n(394),$=document.createElement("canvas");$.width=300,$.height=300,$.style.display="none",document.body.appendChild($);var B=$.getContext("2d");B.font="12px Arial";var N=function(e){return B.measureText(e).width},O=function(e,t,n){var a=E(),o=a.searchBg,r=a.searchColor,i=a.fontFamily;if(n){var d=[],c=0;return e.split(n).forEach((function(e,a){d.push(p.a.createElement(m.Text,{listening:!1,x:c,key:"".concat(a,"-1"),text:e,fontSize:12,fill:t,fontFamily:i})),c+=N(e),d.push(p.a.createElement(m.Label,{listening:!1,x:c,key:"".concat(a,"-2")},p.a.createElement(m.Tag,{fill:o}),p.a.createElement(m.Text,{fontSize:12,fill:r,text:n,fontFamily:i}))),c+=N(n)})),d.slice(0,d.length-1)}return p.a.createElement(m.Text,{listening:!1,text:"".concat(e),fontSize:12,fill:t,fontFamily:i})},R=function(e,t,n){var a=1.3*n;t*=2;var o=function(e){for(var t=0,n=[],a=0;a<e.length;a++)e.charCodeAt(a)>0&&e.charCodeAt(a)<128?(t++,n.push(1)):(n.push(2),t+=2);return{len:t,textWidths:n}}(e),r=o.len,i=o.textWidths,d=r*a;if(d>t){for(var c=Math.floor((d-t)/a),l=i.length-1;l>=0;l--){if((c-=i[l])<0)break}return e.substring(0,l)+"\u2026"}return e},j=Object(k.a)().x((function(e){return e[0]})).y((function(e){return e[1]}));function M(e){return j.curve(w.a)(e.map((function(e){return[e.x,e.y]})))}var W=function(e){var t,n,a=e.type,o=e.node,r=e.onContextMenu,i=e.onClick,d=e.onHover,l=e.onOutHover,s=e.searchKey,u=e.stage,h=Object(g.useRef)(!1),f=d?Object(g.useCallback)((function(e){console.log(e),h.current||d&&d(o),h.current=!0}),[]):void 0,y=l?Object(g.useCallback)((function(){h.current&&l&&l(o),h.current=!1}),[]):void 0,v=E().nodeWidth;return p.a.createElement(m.Group,{x:o.x-o.width/2,y:o.y-o.height/2,onClick:function(e){i&&i(e,o)},onContextMenu:function(e){r&&r(e,o)},onMouseEnter:f,onMouseLeave:y},"column"===a&&p.a.createElement(p.a.Fragment,null,p.a.createElement(m.Rect,{listening:!1,cornerRadius:E().nodeBorderRadio,fill:"#FFFFFF",stroke:E("".concat(o.$state$,"Border")),strokeWidth:1.5,width:o.width,height:E().nodeHeight*(((null===(t=o.columns)||void 0===t?void 0:t.length)||0)+1)}),null===(n=o.columns)||void 0===n?void 0:n.map((function(e,t){return o.$columnMap$||(o.$columnMap$={}),o.$columnMap$[e.id]=Object(c.a)({},e,{index:t+1}),p.a.createElement(m.Group,{key:e.id},p.a.createElement(m.Group,{x:18,y:E().nodeHeight*(t+1)+E().halfNodeHeight-6,height:E().nodeHeight},p.a.createElement(m.Rect,{cornerRadius:E().nodeBorderRadio,fill:E().hoverBg,opacity:0,strokeWidth:0,x:-17,y:6-E().halfNodeHeight,width:o.width-2,height:E().nodeHeight,onClick:function(t){t.cancelBubble=!0,i&&i(t,o,e)},onMouseEnter:function(e){e.target.setAttr("opacity",1),u.getStage().batchDraw()},onMouseLeave:function(e){e.target.setAttr("opacity",0),u.getStage().batchDraw()}}),O(R(e.label,v-20,12),E("".concat(e.$state$||o.$state$,"ColumnColor")),s)))}))),p.a.createElement(m.Rect,{cornerRadius:E().nodeBorderRadio,fill:E("".concat(o.$state$,"Bg")),stroke:E("".concat(o.$state$,"Border")),strokeWidth:1.5,width:o.width,height:E().nodeHeight}),p.a.createElement(m.Rect,{fill:E().nodeDot[o.dbType],cornerRadius:[1,1,1,1],width:6,height:6,x:8,y:E().halfNodeHeight-3}),p.a.createElement(m.Group,{x:18,y:E().halfNodeHeight-6},O(R(o.label,v-20,12),E("".concat(o.$state$,"Color")),s)))},P=n(83),S=function(e){var t=e.startPoint,n=e.endPoint,a=e.direction,o=e.edgeColor,r="",i="";"top"===a?(r="".concat(t.x-80," ").concat(t.y-40),i="".concat(t.x+80," ").concat(t.y-40)):"bottom"===a?(r="".concat(t.x-80," ").concat(t.y+40),i="".concat(t.x+80," ").concat(t.y+40)):"right"===a?(r="".concat(t.x+40," ").concat(t.y+80),i="".concat(n.x+40," ").concat(n.y-80)):(r="".concat(t.x-40," ").concat(t.y+80),i="".concat(n.x+40," ").concat(n.y-80));var d=E().edgeWidth;return p.a.createElement(m.Group,{listening:!1},p.a.createElement(m.Path,{data:"M".concat(t.x," ").concat(t.y," C").concat(r," ").concat(i," ").concat(n.x," ").concat(n.y),stroke:o,strokeWidth:d}),p.a.createElement(m.Group,{x:t.x,y:t.y},p.a.createElement(m.Path,{offsetY:0,offsetX:0,rotation:-30,fill:o,data:"M 0 0 L -5 -2.5 L -5 2.5 Z"})))};var G=function(e){var t=e.startNode,n=e.endNode,a=e.edge,o=e.type,r=E("".concat(a.$state$,"edgeColor"));if(t.id===n.id){var i={x:t.x,y:t.y+t.height/2};return p.a.createElement(S,{edgeColor:r,direction:"bottom",startPoint:i,endPoint:i})}var d=Object(g.useMemo)((function(){return function(e,t,n,a){if("column"===a){var o=e.$columnMap$[n.startCol],r=t.$columnMap$[n.endCol],i=E().nodeHeight;return[{x:e.x+e.width/2,y:e.y-e.height/2+i*(o.index+.5)}].concat(Object(P.a)(n.points.slice(1,-1)),[{x:t.x-t.width/2,y:t.y-t.height/2+i*(r.index+.5)}])}return[{x:e.x+e.width/2,y:e.y}].concat(Object(P.a)(n.points.slice(1,-1)),[{x:t.x-t.width/2,y:t.y}])}(t,n,a,o)}),[t.y,t.x,n.x,n.y,JSON.stringify(a.points),o]),c=d[0],l=d[a.points.length-1],s=d.length<=4?{x:(c.x+l.x)/2,y:l.y}:d[a.points.length-2],u=E().edgeWidth,h=Object(g.useMemo)((function(){return 180*Math.atan2(l.y-s.y,l.x-s.x)/Math.PI}),[l.x,l.y,s.y,s.x]);return p.a.createElement(m.Group,{listening:!1},d.length<=4?p.a.createElement(m.Arrow,{listening:!1,points:[c.x,c.y,(c.x+l.x)/2,c.y,s.x,s.y,l.x,l.y],pointerWidth:3,pointerLength:3,bezier:!0,stroke:r,strokeWidth:1.5}):p.a.createElement(p.a.Fragment,null,p.a.createElement(m.Path,{data:M(d),stroke:r,strokeWidth:u}),p.a.createElement(m.Group,{x:l.x,y:l.y},p.a.createElement(m.Path,{rotation:h,data:"M 0 0 L -5 -2.5 L -5 2.5 z",fill:r,strokeWidth:u}))))},F=function(e){var t=e.node,n=e.groupBy,a="".concat(n.label,": ").concat(t[n.key]);return p.a.createElement(m.Group,{listening:!1,x:t.x-t.width/2,y:t.y-t.height/2},p.a.createElement(m.Group,{x:0,y:-27},p.a.createElement(m.Rect,{cornerRadius:[2,2,2,2],height:28,width:N(a)+8,fill:E().groupBg}),p.a.createElement(m.Text,{text:a,fill:E().groupColor,y:8,x:4})),p.a.createElement(m.Rect,{listening:!1,dash:[4,4],stroke:E().groupBorder,strokeWidth:1.5,width:t.width,height:t.height}))},H=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={dimensions:{width:0,height:0}},a.graph=void 0,a.stage=g.createRef(),a.layer=g.createRef(),a.getStage=function(){return a.stage.current.getStage()},a.fitView=function(){var e=a.getStage(),t=a.state.dimensions,n=t.width,o=t.height,r=e.getClientRect({skipTransform:!0}),i=r.width,d=r.height,c=Math.min(n/i,o/d)-.15;if(c<1){e.getStage().scale({x:c,y:c});var l={x:n/2-i*c/2,y:o/2-d*c/2};e.position(l)}else{var s={x:n/2-i/2,y:o/2-d/2};e.position(s)}e.batchDraw()},a.onWheel=function(e){e.evt.preventDefault();var t=a.stage.current.getStage(),n=t.scaleX(),o=t.getPointerPosition().x/n-t.x()/n,r=t.getPointerPosition().y/n-t.y()/n,i=e.evt.deltaY>0?.96*n:n/.96;if(!(e.evt.deltaY>0&&i<.1)){t.scale({x:i,y:i});var d={x:-(o-t.getPointerPosition().x/i)*i,y:-(r-t.getPointerPosition().y/i)*i};t.position(d),t.batchDraw()}},a.scale=function(e){var t=a.getStage();e<.1||(t.getStage().scale({x:e,y:e}),t.batchDraw())},a.setGraph(e),a}return Object(s.a)(n,[{key:"setGraph",value:function(e){var t=this,n=e.nodes,a=e.edges,o=e.type,r=e.groupBy,i=e.activeNode,l=e.primaryNode;this.graph=new y.graphlib.Graph({directed:!0,multigraph:!0,compound:!!r}),this.graph.setGraph({rankdir:"LR",edgesep:40}).setDefaultEdgeLabel((function(){return{}}));var s=i?"disable":"secondary",u=E(),h=u.nodeHeight,f=u.nodeWidth;if(n.forEach((function(e){var n,a,r="column"===o&&(null===(n=e.columns)||void 0===n?void 0:n.length)?(null===(a=e.columns)||void 0===a?void 0:a.length)+1:1;t.setNode(Object(c.a)({label:e.id,width:f,height:h*r,$state$:s},e),s,o,l)})),a.forEach((function(e,n){if(i){if((e.start===i.id||e.end===i.id)&&("column"===o&&(e.start===i.id&&e.startCol===i.columnId||e.end===i.id&&e.endCol===i.columnId)||"column"!==o)){s="active";var a=t.graph.node(e.start),r=t.graph.node(e.end);return t.setNode(a,s,o,l,e.start),t.setNode(r,s,o,l,e.end),void t.graph.setEdge(e.start,e.end,Object(c.a)({},e,{$state$:""}),"".concat(n))}t.graph.setEdge(e.start,e.end,Object(c.a)({},e,{$state$:"disable"}),"".concat(n))}else t.graph.setEdge(e.start,e.end,Object(c.a)({},e,{$state$:""}),"".concat(n))})),r){var g=b.a.groupBy(n,r.key);Object.keys(g).forEach((function(e){var n,a="$group_".concat(e,"$");t.graph.setNode(a,(n={label:e},Object(d.a)(n,r.key,e),Object(d.a)(n,x,!0),n)),g[e].forEach((function(e){t.graph.setParent(e.id,a)}))}))}Object(y.layout)(this.graph)}},{key:"setNode",value:function(e,t,n,a,o){var r;"column"===n&&(null===(r=e.columns)||void 0===r||r.forEach((function(e){e.id==o&&(e.$state$=t)}))),(null===a||void 0===a?void 0:a.id)&&(null===a||void 0===a?void 0:a.id)==e.id?this.graph.setNode(e.id,Object(c.a)({},e,{$state$:"primary"})):this.graph.setNode(e.id,Object(c.a)({},e,{$state$:"column"===n&&"active"===t?"secondary":t}))}},{key:"shouldComponentUpdate",value:function(e,t){return(this.props!==e||this.state!==t)&&(this.props.nodes===e.nodes&&this.props.edges===e.edges||this.setGraph(e),!0)}},{key:"componentDidUpdate",value:function(e,t){t.dimensions===this.state.dimensions&&this.props.nodes===e.nodes&&this.props.edges===e.edges||this.fitView()}},{key:"render",value:function(){var e=this,t=this.state.dimensions;return g.createElement(f.a,{bounds:!0,onResize:function(t){e.setState({dimensions:t.bounds||{width:0,height:0}})}},(function(n){var a=n.measureRef;return g.createElement("div",{ref:a,className:"dag-container"},g.createElement(m.Stage,{ref:e.stage,onWheel:e.onWheel,width:t.width,height:t.height,dragBoundFunc:function(e){return{x:e.x,y:e.y}},draggable:!0},g.createElement(m.Layer,{ref:e.layer},e.graph.nodes().map((function(t){var n=e.graph.node(t);return n[x]?g.createElement(F,{key:t,node:n,groupBy:e.props.groupBy}):g.createElement(W,{key:t,type:e.props.type,node:n,onContextMenu:e.props.onNodeContextMenu,onClick:e.props.onNodeClick,activeNode:e.props.activeNode,searchKey:e.props.searchKey,stage:e.stage.current})})),e.graph.edges().map((function(t){var n=e.graph.edge(t),a=e.graph.node(t.v),o=e.graph.node(t.w);return g.createElement(G,{key:t.v+t.w+t.name,type:e.props.type,startNode:a,endNode:o,edge:n,activeNode:e.props.activeNode})})))))}))}}]),n}(g.Component);H.defaultProps={type:"default"};var L=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(H,{edges:[{start:"1",end:"2"},{start:"2",end:"3"},{start:"3",end:"3"},{start:"1",end:"5"},{start:"1",end:"5"},{start:"3",end:"5"},{start:"3",end:"4"}],nodes:[{id:"1",name:"1",label:"1"},{id:"2",name:"1",label:"2"},{id:"3",name:"2",label:"3"},{id:"4",name:"2",label:"4"},{id:"5",name:"1",label:"5"}],groupBy:{key:"name",label:"\u8d1f\u8d23\u4eba"},activeNode:{id:"2"}}))},D=n(155);var T=function(){var e=Object(a.useState)(void 0),t=Object(D.a)(e,2),n=t[0],r=t[1];return console.log("activeNode",n),o.a.createElement("div",{className:"App"},o.a.createElement(H,{edges:[{start:"1",end:"2",startCol:"1",endCol:"2"},{start:"2",end:"3",startCol:"1",endCol:"2"},{start:"3",end:"3",startCol:"1",endCol:"2"},{start:"1",end:"5",startCol:"1",endCol:"2"},{start:"1",end:"5",startCol:"2",endCol:"1"},{start:"3",end:"5",startCol:"1",endCol:"2"},{start:"3",end:"4",startCol:"1",endCol:"2"}],nodes:[{id:"1",name:"1",label:"moring",columns:[{id:"1",label:"nihao"},{id:"2",label:"moring"}]},{id:"2",name:"1",label:"nihao",columns:[{id:"1",label:"nihao"},{id:"2",label:"moring"},{id:"3",label:"hello"}]},{id:"3",name:"2",label:"hello",columns:[{id:"1",label:"hello"},{id:"2",label:"2"}]},{id:"4",name:"2",label:"42345678909876543245678987654324567890987654345678987654345t6y78",columns:[{id:"1",label:"1"},{id:"2",label:"2"},{id:"3",label:"3"}]},{id:"5",name:"1",label:"5",columns:[{id:"1",label:"1"},{id:"2",label:"2"},{id:"3",label:"3"}]}],groupBy:{key:"name",label:"\u8d1f\u8d23\u4eba"},type:"column",primaryNode:{id:"2"},activeNode:n,searchKey:"hello",onNodeClick:function(e,t,a){console.log(e,t,a),t.id!==(null===n||void 0===n?void 0:n.id)||n.columnId!==(null===a||void 0===a?void 0:a.id)?r({id:t.id,columnId:null===a||void 0===a?void 0:a.id}):r(void 0)}}))};i.a.render(o.a.createElement(o.a.Fragment,null,window.location.pathname.includes("col")?o.a.createElement(T,null):o.a.createElement(L,null)),document.getElementById("root"))}},[[158,1,2]]]);
//# sourceMappingURL=main.c09a5d8d.chunk.js.map