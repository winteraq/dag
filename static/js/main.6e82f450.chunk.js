(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[0],{150:function(e,t){},151:function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var a=n(38),o=n(20),r=n(153),i=n(154),d=n(157),c=n(160),l=(n(167),n(159)),s=n(0),u=n.n(s),h=n(5),f=n(83),g=n(156),p=n.n(g),m=Symbol("isGroup"),y={nodeWidth:158,nodeHeight:28,halfNodeWidth:79,halfNodeHeight:14,nodeBorderRadio:[2,2,2,2],primaryColor:"#ffffff",primaryColumnColor:"#606a78",primaryBorder:"#4660ef",primaryBg:"#4660ef",primaryBorderRadio:[2,2,2,2],secondaryColor:"#282f38",secondaryColumnColor:"#606a78",secondaryBg:"#ffffff",secondaryBorder:"#8b9dff",secondaryBorderRadio:[2,2,2,2],disableColor:"#ffffff",disableColumnColor:"#939aa3",disableBg:"#c3c8cd",disableBorder:"#f5f6fa",disableBorderRadio:[2,2,2,2],activeColor:"#416eff",activeColumnColor:"#416eff",activeBg:"#ffffff",activeBorder:"#8b9dff",activeBorderRadio:[2,2,2,2],searchBg:"#ffe95b",searchColor:"#282f38",groupBorder:"#4660ef",groupBg:"#4660ef",groupColor:"#ffffff",edgeColor:"#a8b6c7",edgeWidth:1.5,disableedgeColor:"#d5dadf",activeNodeColor:"#416eff",fontFamily:"Ubuntu Mono, Tahoma",hoverBg:"#f5f6fa",nodeDot:{hive:"#33d6cc",clickhouse:"#f5f6fa",mysql:"#8a77ed",kafka:"#34adf0",hdfs:"#5dcd81",druid:"#ed55b0",abase:"#33d6cc",tableau:"#ffbc0a",abtest:"#8a77ed",redis:"#34adf0",undefined:"#f25c61"}},v=function(e){return e?y[e]:y},b=n(398),x=n(397),C=document.createElement("canvas");C.width=300,C.height=300,C.style.display="none",document.body.appendChild(C);var E=C.getContext("2d");E.font="12px Arial";var k=function(e){return E.measureText(e).width},w=function(e,t,n){var a=v(),o=a.searchBg,r=a.searchColor,i=a.fontFamily;if(n){var d=[],c=0;return e.split(n).forEach((function(e,a){d.push(u.a.createElement(h.Text,{listening:!1,x:c,key:"".concat(a,"-1"),text:e,fontSize:12,fill:t,fontFamily:i})),c+=k(e),d.push(u.a.createElement(h.Label,{listening:!1,x:c,key:"".concat(a,"-2")},u.a.createElement(h.Tag,{fill:o}),u.a.createElement(h.Text,{fontSize:12,fill:r,text:n,fontFamily:i}))),c+=k(n)})),d.slice(0,d.length-1)}return u.a.createElement(h.Text,{listening:!1,text:"".concat(e),fontSize:12,fill:t,fontFamily:i})},$=function(e,t,n){var a=1.3*n;t*=2;var o=function(e){for(var t=0,n=[],a=0;a<e.length;a++)e.charCodeAt(a)>0&&e.charCodeAt(a)<128?(t++,n.push(1)):(n.push(2),t+=2);return{len:t,textWidths:n}}(e),r=o.len,i=o.textWidths,d=r*a;if(d>t){for(var c=Math.floor((d-t)/a),l=i.length-1;l>=0;l--){if((c-=i[l])<0)break}return e.substring(0,l)+"\u2026"}return e},B=Object(b.a)().x((function(e){return e[0]})).y((function(e){return e[1]}));function N(e){return B.curve(x.a)(e.map((function(e){return[e.x,e.y]})))}var O=function(e){var t,n,a=e.type,r=e.node,i=e.onContextMenu,d=e.onClick,c=e.onHover,l=e.onOutHover,f=e.searchKey,g=e.stage,p=Object(s.useRef)(!1),m=c?Object(s.useCallback)((function(e){console.log(e),p.current||c&&c(r),p.current=!0}),[]):void 0,y=l?Object(s.useCallback)((function(){p.current&&l&&l(r),p.current=!1}),[]):void 0,b=v().nodeWidth;return u.a.createElement(h.Group,{x:r.x-r.width/2,y:r.y-r.height/2,onClick:function(e){d&&d(e,r)},onContextMenu:function(e){i&&i(e,r)},onMouseEnter:m,onMouseLeave:y},"column"===a&&u.a.createElement(u.a.Fragment,null,u.a.createElement(h.Rect,{listening:!1,cornerRadius:v().nodeBorderRadio,fill:"#FFFFFF",stroke:v("".concat(r.$state$,"Border")),strokeWidth:1.5,width:r.width,height:v().nodeHeight*(((null===(t=r.columns)||void 0===t?void 0:t.length)||0)+1)}),null===(n=r.columns)||void 0===n?void 0:n.map((function(e,t){return r.$columnMap$||(r.$columnMap$={}),r.$columnMap$[e.id]=Object(o.a)({},e,{index:t+1}),u.a.createElement(h.Group,{key:e.id},u.a.createElement(h.Group,{x:18,y:v().nodeHeight*(t+1)+v().halfNodeHeight-6,height:v().nodeHeight},u.a.createElement(h.Rect,{cornerRadius:v().nodeBorderRadio,fill:v().hoverBg,opacity:0,strokeWidth:0,x:-17,y:6-v().halfNodeHeight,width:r.width-2,height:v().nodeHeight,onClick:function(t){t.cancelBubble=!0,d&&d(t,r,e)},onMouseEnter:function(e){e.target.setAttr("opacity",1),g.getStage().batchDraw()},onMouseLeave:function(e){e.target.setAttr("opacity",0),g.getStage().batchDraw()}}),w($(e.label,b-20,12),v("".concat(e.$state$||r.$state$,"ColumnColor")),f)))}))),u.a.createElement(h.Rect,{cornerRadius:v().nodeBorderRadio,fill:v("".concat(r.$state$,"Bg")),stroke:v("".concat(r.$state$,"Border")),strokeWidth:1.5,width:r.width,height:v().nodeHeight}),u.a.createElement(h.Rect,{fill:v().nodeDot[r.dbType],cornerRadius:[1,1,1,1],width:6,height:6,x:8,y:v().halfNodeHeight-3}),u.a.createElement(h.Group,{x:18,y:v().halfNodeHeight-6},w($(r.label,b-20,12),v("".concat(r.$state$,"Color")),f)))},R=n(84),j=function(e){var t=e.startPoint,n=e.endPoint,a=e.direction,o=e.edgeColor,r="",i="";"top"===a?(r="".concat(t.x-80," ").concat(t.y-40),i="".concat(t.x+80," ").concat(t.y-40)):"bottom"===a?(r="".concat(t.x-80," ").concat(t.y+40),i="".concat(t.x+80," ").concat(t.y+40)):"right"===a?(r="".concat(t.x+40," ").concat(t.y+80),i="".concat(n.x+40," ").concat(n.y-80)):(r="".concat(t.x-40," ").concat(t.y+80),i="".concat(n.x+40," ").concat(n.y-80));var d=v().edgeWidth;return u.a.createElement(h.Group,{listening:!1},u.a.createElement(h.Path,{data:"M".concat(t.x," ").concat(t.y," C").concat(r," ").concat(i," ").concat(n.x," ").concat(n.y),stroke:o,strokeWidth:d}),u.a.createElement(h.Group,{x:t.x,y:t.y},u.a.createElement(h.Path,{offsetY:0,offsetX:0,rotation:-30,fill:o,data:"M 0 0 L -5 -2.5 L -5 2.5 Z"})))};var M=function(e){var t=e.startNode,n=e.endNode,a=e.edge,o=e.type,r=v("".concat(a.$state$,"edgeColor"));if(t.id===n.id){var i={x:t.x,y:t.y+t.height/2};return u.a.createElement(j,{edgeColor:r,direction:"bottom",startPoint:i,endPoint:i})}var d=Object(s.useMemo)((function(){return function(e,t,n,a){if("column"===a){var o=e.$columnMap$[n.startCol],r=t.$columnMap$[n.endCol],i=v().nodeHeight;return[{x:e.x+e.width/2,y:e.y-e.height/2+i*(o.index+.5)}].concat(Object(R.a)(n.points.slice(1,-1)),[{x:t.x-t.width/2,y:t.y-t.height/2+i*(r.index+.5)}])}return[{x:e.x+e.width/2,y:e.y}].concat(Object(R.a)(n.points.slice(1,-1)),[{x:t.x-t.width/2,y:t.y}])}(t,n,a,o)}),[t.y,t.x,n.x,n.y,JSON.stringify(a.points),o]),c=d[0],l=d[a.points.length-1],f=d.length<=4?{x:(c.x+l.x)/2,y:l.y}:d[a.points.length-2],g=v().edgeWidth,p=Object(s.useMemo)((function(){return 180*Math.atan2(l.y-f.y,l.x-f.x)/Math.PI}),[l.x,l.y,f.y,f.x]);return u.a.createElement(h.Group,{listening:!1},d.length<=4?u.a.createElement(h.Arrow,{listening:!1,points:[c.x,c.y,(c.x+l.x)/2,c.y,f.x,f.y,l.x,l.y],pointerWidth:3,pointerLength:3,bezier:!0,stroke:r,strokeWidth:1.5}):u.a.createElement(u.a.Fragment,null,u.a.createElement(h.Path,{data:N(d),stroke:r,strokeWidth:g}),u.a.createElement(h.Group,{x:l.x,y:l.y},u.a.createElement(h.Path,{rotation:p,data:"M 0 0 L -5 -2.5 L -5 2.5 z",fill:r,strokeWidth:g}))))},W=function(e){var t=e.node,n=e.groupBy,a="".concat(n.label,": ").concat(t[n.key]);return u.a.createElement(h.Group,{listening:!1,x:t.x-t.width/2,y:t.y-t.height/2},u.a.createElement(h.Group,{x:0,y:-27},u.a.createElement(h.Rect,{cornerRadius:[2,2,2,2],height:28,width:k(a)+8,fill:v().groupBg}),u.a.createElement(h.Text,{text:a,fill:v().groupColor,y:8,x:4})),u.a.createElement(h.Rect,{listening:!1,dash:[4,4],stroke:v().groupBorder,strokeWidth:1.5,width:t.width,height:t.height}))},P=function(e){Object(c.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={dimensions:{width:0,height:0}},a.graph=void 0,a.stage=s.createRef(),a.layer=s.createRef(),a.getStage=function(){return a.stage.current.getStage()},a.fitView=function(){var e=a.getStage(),t=a.state.dimensions,n=t.width,o=t.height,r=e.getClientRect({skipTransform:!0}),i=r.width,d=r.height,c=Math.min(n/i,o/d)-.15;if(c<1){e.getStage().scale({x:c,y:c});var l={x:n/2-i*c/2,y:o/2-d*c/2};e.position(l)}else{var s={x:n/2-i/2,y:o/2-d/2};e.position(s)}e.batchDraw()},a.onWheel=function(e){e.evt.preventDefault();var t=a.stage.current.getStage(),n=t.scaleX(),o=t.getPointerPosition().x/n-t.x()/n,r=t.getPointerPosition().y/n-t.y()/n,i=e.evt.deltaY>0?.96*n:n/.96;if(!(e.evt.deltaY>0&&i<.1)){t.scale({x:i,y:i});var d={x:-(o-t.getPointerPosition().x/i)*i,y:-(r-t.getPointerPosition().y/i)*i};t.position(d),t.batchDraw()}},a.scale=function(e){var t=a.getStage();e<.1||(t.getStage().scale({x:e,y:e}),t.batchDraw())},a.setGraph(e),a}return Object(i.a)(n,[{key:"setGraph",value:function(e){var t=this,n=e.nodes,r=e.edges,i=e.type,d=e.groupBy,c=e.activeNode,l=e.primaryNode;this.graph=new f.graphlib.Graph({directed:!0,multigraph:!0,compound:!!d}),this.graph.setGraph({rankdir:"LR",edgesep:40}).setDefaultEdgeLabel((function(){return{}}));var s=c?"disable":"secondary",u=v(),h=u.nodeHeight,g=u.nodeWidth;if(n.forEach((function(e){var n,a,r="column"===i&&(null===(n=e.columns)||void 0===n?void 0:n.length)?(null===(a=e.columns)||void 0===a?void 0:a.length)+1:1;t.setNode(Object(o.a)({label:e.id,width:g,height:h*r,$state$:s},e),e.id===(null===c||void 0===c?void 0:c.id)?"active":s,i,l,e.id===(null===c||void 0===c?void 0:c.id)?null===c||void 0===c?void 0:c.columnId:void 0)})),r.forEach((function(e,n){if(c){if((e.start===c.id||e.end===c.id)&&("column"===i&&(e.start===c.id&&e.startCol===c.columnId||e.end===c.id&&e.endCol===c.columnId)||"column"!==i)){s="active";var a=t.graph.node(e.start),r=t.graph.node(e.end);return t.setNode(a,s,i,l,"column"===i?e.startCol:e.start),t.setNode(r,s,i,l,"column"===i?e.endCol:e.end),void t.graph.setEdge(e.start,e.end,Object(o.a)({},e,{$state$:""}),"".concat(n))}t.graph.setEdge(e.start,e.end,Object(o.a)({},e,{$state$:"disable"}),"".concat(n))}else t.graph.setEdge(e.start,e.end,Object(o.a)({},e,{$state$:""}),"".concat(n))})),d){var y=p.a.groupBy(n,d.key);Object.keys(y).forEach((function(e){var n,o="$group_".concat(e,"$");t.graph.setNode(o,(n={label:e},Object(a.a)(n,d.key,e),Object(a.a)(n,m,!0),n)),y[e].forEach((function(e){t.graph.setParent(e.id,o)}))}))}Object(f.layout)(this.graph)}},{key:"setNode",value:function(e,t,n,a,r){"column"===n&&r&&Array.isArray(e.columns)&&e.columns.forEach((function(e){e.id===r&&(e.$state$=t)})),(null===a||void 0===a?void 0:a.id)&&(null===a||void 0===a?void 0:a.id)===e.id?this.graph.setNode(e.id,Object(o.a)({},e,{$state$:"primary"})):this.graph.setNode(e.id,Object(o.a)({},e,{$state$:"column"===n&&"active"===t?"secondary":t}))}},{key:"shouldComponentUpdate",value:function(e,t){return(this.props!==e||this.state!==t)&&(this.props.nodes===e.nodes&&this.props.edges===e.edges||this.setGraph(e),!0)}},{key:"componentDidUpdate",value:function(e,t){t.dimensions===this.state.dimensions&&this.props.nodes===e.nodes&&this.props.edges===e.edges||this.fitView()}},{key:"render",value:function(){var e=this,t=this.state.dimensions;return s.createElement(l.a,{bounds:!0,onResize:function(t){e.setState({dimensions:t.bounds||{width:0,height:0}})}},(function(n){var a=n.measureRef;return s.createElement("div",{ref:a,className:"dag-container"},s.createElement(h.Stage,{ref:e.stage,onWheel:e.onWheel,width:t.width,height:t.height,dragBoundFunc:function(e){return{x:e.x,y:e.y}},draggable:!0},s.createElement(h.Layer,{ref:e.layer},e.graph.nodes().map((function(t){var n=e.graph.node(t);return n[m]?s.createElement(W,{key:t,node:n,groupBy:e.props.groupBy}):s.createElement(O,{key:t,type:e.props.type,node:n,onContextMenu:e.props.onNodeContextMenu,onClick:e.props.onNodeClick,activeNode:e.props.activeNode,searchKey:e.props.searchKey,stage:e.stage.current})})),e.graph.edges().map((function(t){var n=e.graph.edge(t),a=e.graph.node(t.v),o=e.graph.node(t.w);return s.createElement(M,{key:t.v+t.w+t.name,type:e.props.type,startNode:a,endNode:o,edge:n,activeNode:e.props.activeNode})})))))}))}}]),n}(s.Component);P.defaultProps={type:"default"}},161:function(e,t,n){e.exports=n(394)},166:function(e,t,n){},167:function(e,t,n){},394:function(e,t,n){"use strict";n.r(t);var a=n(11),o=n.n(a),r=n(152),i=n.n(r),d=(n(166),n(60));var c=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(d.Dag,{edges:[{start:"1",end:"2"},{start:"2",end:"3"},{start:"3",end:"3"},{start:"1",end:"5"},{start:"1",end:"5"},{start:"3",end:"5"},{start:"3",end:"4"}],nodes:[{id:"1",name:"1",label:"1"},{id:"2",name:"1",label:"2"},{id:"3",name:"2",label:"3"},{id:"4",name:"2",label:"4"},{id:"5",name:"1",label:"5"}],groupBy:{key:"name",label:"\u8d1f\u8d23\u4eba"},activeNode:{id:"2"}}))},l=n(158);var s=function(){var e=Object(a.useState)({id:"4",columnId:"1"}),t=Object(l.a)(e,2),n=t[0],r=t[1];return console.log("activeNode",n),o.a.createElement("div",{className:"App"},o.a.createElement(d.Dag,{edges:[{start:"1",end:"2",startCol:"1",endCol:"2"},{start:"2",end:"3",startCol:"1",endCol:"2"},{start:"3",end:"3",startCol:"1",endCol:"1"},{start:"1",end:"5",startCol:"1",endCol:"2"},{start:"1",end:"5",startCol:"2",endCol:"1"},{start:"3",end:"5",startCol:"1",endCol:"2"},{start:"3",end:"4",startCol:"1",endCol:"2"}],nodes:[{id:"1",name:"1",label:"moring",columns:[{id:"1",label:"nihao"},{id:"2",label:"moring"}]},{id:"2",name:"1",label:"nihao",columns:[{id:"1",label:"nihao"},{id:"2",label:"moring"},{id:"3",label:"hello"}]},{id:"3",name:"2",label:"hello title",columns:[{id:"1",label:"hello"},{id:"2",label:"2"}]},{id:"4",name:"2",label:"\u8d85\u957f\u7684\u6587\u672c\u88ab\u622a\u65ad\u4e86",columns:[{id:"1",label:"1"},{id:"2",label:"2"},{id:"3",label:"3"}]},{id:"5",name:"1",label:"5",columns:[{id:"1",label:"1"},{id:"2",label:"2"},{id:"3",label:"3"}]}],groupBy:{key:"name",label:"\u8d1f\u8d23\u4eba"},type:"column",primaryNode:{id:"2"},activeNode:n,searchKey:"hello",onNodeClick:function(e,t,a){console.log(e,t,a),t.id!==(null===n||void 0===n?void 0:n.id)||n.columnId!==(null===a||void 0===a?void 0:a.id)?r({id:t.id,columnId:null===a||void 0===a?void 0:a.id}):r(void 0)}}))};i.a.render(o.a.createElement(o.a.Fragment,null,window.location.pathname.includes("col")?o.a.createElement(s,null):o.a.createElement(c,null)),document.getElementById("root"))},60:function(e,t,n){"use strict";var a=n(151);n.d(t,"Dag",(function(){return a.a}));n(150)}},[[161,1,2]]]);
//# sourceMappingURL=main.6e82f450.chunk.js.map